#!/bin/bash -x

SCRIPT_DIR=$(dirname "$BASH_SOURCE")
slot=${SCRIPT_DIR%????????}

IS_HANDHELD=0
if [ "$(cat /etc/rootfs_version | grep -i VS)" ]; then
	IS_HANDHELD=0
elif [ "$(cat /etc/rootfs_version | grep -i 'Super Pocket')" ]; then
	IS_HANDHELD=1
else
	IS_HANDHELD=1
fi

env \
    HOME=$slot/ \
    IS_HANDHELD=${IS_HANDHELD} \
    XDG_CONFIG_HOME=$slot/ \
    LD_LIBRARY_PATH=$slot/retroarch/lib \
    /usr/bin/retroarch2 -c "$slot/retroarch/config/retroarch.cfg" -L "$slot/retroarch/cores/{CORE_FILENAME}" "$slot/roms/{ROM_FILENAME}"